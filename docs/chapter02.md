# Chapter 02. TDD 시작하기

---
<br>

- TDD 를 사용하지 않으면?
  - 코드를 작성하는 개발자와 그 코드를 테스트하는 개발자가 다를때도 있다. => 테스트 과정도 길어지고, 오류 찾는데도 시간이 많이 걸림
  - 한 번에 구현하는 코드가 많을수록 디버깅할 때 스트레스가 높아진다.

<br>

## TDD 란?

- 테스트 부터 시작한다. 
- 구현을 먼저 하고 나중에 테스트하는 것이 아니라, 먼저 테스트를 하고 그 다음에 구현한다.
- 테스트를 먼저 한다는 것은, 기능이 올바르게 동작하는지 검증하고 테스트 코드를 작성한다는 것을 의미한다.

```
assertEquals(expected, real)

실행한 결과가 기대한 값인지 검증한다. 인자로 받은 두 값이 동일한지 비교한다.
첫번째 인자는 기대한 값이고, 두번째 인자는 실제 값이다.
비교한 결과 두 값이 동일하지 않으면 AssertionFailedError 가 발생한다.
```

- 고려사항
  - 메서드 이름, 파라미터 타입 및 개수, 정적 메서드인지 인스턴스 메서드인지, 클래스 이름 등등..


<br>

## TDD 예 : 암호 검사기
- 암호 검사기는 문자열을 검사해서 규칙을 준수하는지에 따라 암호를 '약함', '보통, '강함'으로 구분한다.
- 다음과 같은 규칙을 이용하여 암호를 검사한다.
  - 길이가 8글자 이상
  - 0부터 9사이의 숫자를 포함
  - 대문자 포함

<br>

## 첫 번째 테스트 : 모든 규칙을 충족하는 경우 

- 첫번째 테스트를 선택할 때에는 가장 쉽거나 가장 예외적인 상황을 선택해야 한다.
- 암호 검사 기능의 예를 들어보면 아래와 같다.
  - 모든 규칙을 충족하는 경우
  - 모든 조건을 충족하지 않는 경우 
- 하지만 모든 조건을 충족하지 않는 테스트를 통과시키려면 각 조건을 검사한느 코드를 모두 구현해야 하고, 한 번에 만들어야 할 코드가 많아지므로 첫번째 테스트 코드를 통과하는 시간도 길어진다.
- 이는 사실상 구현을 다 하고 테스트를 하는 방식과 다르지 않다.
- 반면, 모든 규칙을 충족하는 경우는 테스트를 쉽게 통과시킬 수 있다. (각 조건을 검사하는 코드를 모두 만들지 않아도 되므로)


<br>

## 두 번째 테스트 : 길이만 8글자 미만이고 나머지 조건은 충족하는 경우.
- 이 경우, 암호의 강도는 보통이여야 한다. (조건 1개 누락)

<br>

## 세 번째 테스트 : 숫자를 포함하지 않고 나머지 조건은 충족하는 경우
- 이 경우도, 암호의 강도는 보통이다.

<br>

## 코드 정리 : 테스트 코드 정리
- 테스트 코드도 코드이기 때문에 유지보수 대상이다. => 중복 제거 가능
- 단, 무턱대고 중복을 제거하면 안된다. 중복을 제거한 뒤에도 테스트 코드의 가독성이 떨어지지 않고 수정이 용이한 경우에만 중복을 제거해야 한다.

<br>

## 네 번째 테스트 : 값이 없는 경우
- 예외상황을 고려하여 개발을 진행해야 한다. 
- null 인 경우, 혹은 빈 문자열(""")인 경우.

<br>

## 다섯 번째 테스트 : 대문자를 포함하지 않고 나머지 조건을 충족하는 경우 
- 이 경우도, 암호의 강도는 보통이다.

## 여섯 번째 테스트 : 한가지 조건만 충족되는 경우 
- 이제 남은 것은 한가지 조건만 충족하거나, 모든 조건을 충족하지 않은 경우이다.
- 이 경우 암호 강도는 약함이 된다.

## 일곱 번째 테스트 : 아무 조건도 충족하지 않은 경우 


<br>

## TDD 흐름
- TDD는 테스트를 먼저 작성하고 테스트를 통과시킬 만큼 코드를 작성하고 리팩토링으로 마무리 하는 과정을 반복한다.
- TDD는 기능을 검증하는 테스트를 먼저 작성하고, 작성한 테스트를 통과하지 못하면 테스트를 통과할 만큼만 코드를 작성한다.
- 테스트를 통과한 뒤에는 개선할 코드가 있으면 리팩토링한다.
- 리팩토링을 수행한 뒤에는 다시 테스트를 실행해서 기존 기능이 망가지지 않았는지 확인한다.
- 이 과정을 점진적으로 반복하면서 기능을 완성해 나가는것이 전형적인 TDD의 흐름이다.


<br>

## 레드-그린-리팩터 (Read-Green-Refactor)
- TDD 사이클을 레드-그린-리팩터로 부르기도 한다.
- 여기서 레드는 실패하는 테스트를 의미한다. 레드는 테스트 코드가 실패하면 빨간색을 이용해서 실패한 테스트를 보여주는데서 비롯되었다.
- 그린은 성공한 테스트를 의미한다. 즉, 코드를 구현해서 실패하는 테스트를 통과시키는 것을 뜻한다.
- 마지막으로 리팩터는 이름 그대로 리팩토링 과정을 의미한다.

<br>

결과적으로, **테스트 코드를 먼저 작성하면 테스트가 개발을 주도하게 된다.**
테스트 코드를 만들면 다음 개발 범위가 정해진다. 테스트 코드가 추가되면서 검증하는 범위가 넓어질수록 구현도 점점 완성되어가고, 이렇게 테스트가 개발을 주도해 나란다.

구현을 완료한 뒤에는 **리팩토링**을 진행했따.
당장 리팩토링할 대상이나 어떻게 리팩토링해야 할지 생각나지 않으면 다음 테스트를 진행했다. 
테스트 코드 자체도 리팩토링 대상에 넣었다.
잘 동작하는 코드를 수정하는 것은 심리적으로 불안감을 주기 떄문에 코드 수정을 꺼리게 만든다. 하지만 해당 기능이 온전하게 동작한다는 것을 검증해주는 테스트가 있으면 코드 수정에 대한 심리적 불안감을 줄여준다.


TDD는 개발 과정에서 지속적으로 코드 정리를 하므로 코드 품질이 급격히 나빠지지 않게 막아주는 효곽 ㅏ있다.
이는 향후 유지보수 비용을 낮추는데 기여한다.

TDD가 주는 이점은, 코드 수정에 대한 피드백이 빠르다는 점이다.
새로운 코드를 추가하거나 기존 코드를 수정하면 테스트를 돌려서 해당 코드가 올바른지 바로 확인할 수 있다.
이는 잘못도니 코드가 배포되는 것을 방지한다.